flowchart TD
    subgraph UserDevice[Expo Mobile App]
        direction TB
        UI["UI Screens<br/>(Onboarding, Alerts, Report Modal)"]
        Hooks["React Hooks & Stores<br/>(feedback, telemetry, preferences)"]
        Storage[("AsyncStorage<br/>domain keys")]
        Outbox["Network Outbox<br/>channel router"]
    end

    subgraph Background[Background Services]
        MockDetect[Mock Detection Sweep]
        Notifications[Local Notifications]
    end

    subgraph Remote[Optional Backend Endpoint]
        Endpoint[(EXPO_PUBLIC_FEEDBACK_ENDPOINT)]
    end

    User((User)) -->|Interacts| UI
    UI -->|Dispatch actions| Hooks
    Hooks -->|Persist| Storage
    Hooks -->|Enqueue payloads| Outbox
    Outbox -->|Flush feedback/telemetry/reports| Endpoint
    Endpoint -->|ACK or Retry| Outbox

    MockDetect -->|Detection result| Hooks
    MockDetect -->|Schedule alerts| Notifications
    Notifications -->|Brings user back| UI

    Storage -->|Diagnostics view| UI
    Outbox -->|Diagnostics snapshot| UI

    classDef cloud fill:#eef4ff,stroke:#5b74ff,color:#1c2753;
    class Remote cloud
    classDef storage fill:#fff5d6,stroke:#f4b000,color:#3a2a00;
    class Storage storage
    classDef action fill:#daf5d8,stroke:#38a169,color:#1f4a22;
    class Outbox action